#!/usr/bin/env bash

ESTABLISH_DIR="${HOME}/.establish"

_establish_usage() {
  echo "USAGE:";
  echo -e "\t`basename ${0}` [up|down|upgrade]"
  echo -e "\t`basename ${0}` create"
  echo -e "\t`basename ${0}` test"
  echo -e "\t`basename ${0}` self-update"
  exit 1;
}

case "$1" in
  "" | "up" | "down" | "upgrade")
    COMMAND=${1}
    shift
    . "${ESTABLISH_DIR}/lib/up.sh"
    ;;

  "create")
    shift
    . "${ESTABLISH_DIR}/lib/create.sh"
    ;;
  "test")
    deps=()
    # populate deps=() with generic/*
    for i in ${ESTABLISH_DIR}/generic/*; do
      deps+=(`basename ${i%.sh}`)
    done
    TEST=true
    . "${ESTABLISH_DIR}/lib/up.sh"
    COMMAND="upgrade"
    . "${ESTABLISH_DIR}/lib/up.sh"
    COMMAND="down"
    . "${ESTABLISH_DIR}/lib/up.sh"
    ;;
  "self-update")
    cd ${ESTABLISH_DIR} && git pull
    ;;
  *)
    _establish_usage
    ;;
esac
